{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-md-3">
            <!-- Sidebar de Níveis -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Níveis</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{{ url_for('challenges') }}?level=1" class="list-group-item list-group-item-action {% if level == '1' %}active{% endif %}">
                        Nível 1 - Iniciante
                    </a>
                    <a href="{{ url_for('challenges') }}?level=2" class="list-group-item list-group-item-action {% if level == '2' %}active{% endif %}">
                        Nível 2 - Intermediário
                    </a>
                    <a href="{{ url_for('challenges') }}?level=3" class="list-group-item list-group-item-action {% if level == '3' %}active{% endif %}">
                        Nível 3 - Avançado
                    </a>
                    <a href="{{ url_for('challenges') }}?level=4" class="list-group-item list-group-item-action {% if level == '4' %}active{% endif %}">
                        Nível 4 - Expert
                    </a>
                    <a href="{{ url_for('challenges') }}?level=5" class="list-group-item list-group-item-action {% if level == '5' %}active{% endif %}">
                        Nível 5 - Master
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Desafios - Nível {{ level }}</h2>
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                        Filtrar
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" data-filter="all">Todos</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="completed">Completos</a></li>
                        <li><a class="dropdown-item" href="#" data-filter="pending">Pendentes</a></li>
                    </ul>
                </div>
            </div>

            <div id="challenges-list" class="row">
                <!-- Desafios serão carregados via JavaScript -->
            </div>

            <div id="loading" class="text-center py-4">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Carregando...</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const level = new URLSearchParams(window.location.search).get('level') || '1';
    loadChallenges(level);

    // Filtros
    document.querySelectorAll('[data-filter]').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const filter = this.getAttribute('data-filter');
            filterChallenges(filter);
        });
    });

    function loadChallenges(level) {
        fetch(`/api/challenges?level=${level}`)
            .then(response => response.json())
            .then(challenges => {
                displayChallenges(challenges);
            })
            .catch(error => {
                console.error('Erro ao carregar desafios:', error);
            });
    }

    function displayChallenges(challenges) {
        const container = document.getElementById('challenges-list');
        const loading = document.getElementById('loading');
        
        loading.style.display = 'none';
        container.innerHTML = '';

        challenges.forEach(challenge => {
            const challengeCard = `
                <div class="col-md-6 mb-4" data-challenge-id="${challenge.id}" data-status="pending">
                    <div class="card h-100 challenge-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title">${challenge.title}</h5>
                                <span class="badge bg-${getDifficultyColor(challenge.difficulty)}">
                                    ${challenge.difficulty}
                                </span>
                            </div>
                            <p class="card-text">${challenge.description.substring(0, 100)}...</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">${challenge.points} pontos</small>
                                <a href="/challenge/${challenge.id}" class="btn btn-primary btn-sm">
                                    Ver Desafio
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += challengeCard;
        });
    }

    function getDifficultyColor(difficulty) {
        const colors = {
            'Iniciante': 'success',
            'Intermediário': 'warning',
            'Avançado': 'danger',
            'Expert': 'dark',
            'Master': 'secondary'
        };
        return colors[difficulty] || 'secondary';
    }

    function filterChallenges(filter) {
        const cards = document.querySelectorAll('.challenge-card');
        cards.forEach(card => {
            const status = card.closest('[data-status]').getAttribute('data-status');
            if (filter === 'all' || filter === status) {
                card.closest('.col-md-6').style.display = 'block';
            } else {
                card.closest('.col-md-6').style.display = 'none';
            }
        });
    }
});
</script>
{% endblock %}